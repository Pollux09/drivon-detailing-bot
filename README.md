# Drivon Detailing Telegram Bot

Telegram-бот для записи в детейлинг-студию (`aiogram 3`, `PostgreSQL`, `SQLAlchemy`, `APScheduler`).

## Что реализовано

- Клиентское меню (inline): запись, прайс, акции, контакты, связь с админом.
- FSM-запись: услуга -> тип авто -> дата -> время -> подтверждение.
- Проверка доступности слота по правилам графика и занятости.
- Финальная повторная проверка перед сохранением записи.
- Поддержка масштабирования по постам (`MAX_POSTS`).
- Админ-панель (доступ по Telegram ID):
  - Просмотр всех/сегодняшних записей
  - Добавление/редактирование/деактивация услуг
  - Управление типами авто и множителями
  - Закрытие/открытие слотов
  - Перенос и отмена записей
  - Статистика
- Напоминания подтвержденным записям за 24 часа и за 2 часа.
- Логирование: `logs/app.log`, `logs/errors.log`, `logs/admin_actions.log`, `logs/bookings.log`.

## Важный момент по токену

Токен бота должен храниться только в `.env`. Если токен уже был опубликован, его нужно перевыпустить в `@BotFather`.

## Быстрый запуск (Docker)

Рядом с папкой `drivon-detailing-bot` должна быть папка сайта `drivon-detailing-site`
(compose использует `../drivon-detailing-site` для сборки контейнера `site`).

1. Создайте `.env`:

```bash
cp .env.example .env
```

2. Заполните `.env` (`BOT_TOKEN`, `ADMIN_IDS`, и т.д.)

3. Запустите:

```bash
docker compose up -d --build
```

После этого поднимутся:
- `db` (PostgreSQL)
- `bot` (Telegram-бот)
- `site` (сайт на `http://localhost:8000`)

Сайт читает услуги из той же БД через `DATABASE_URL` и показывает только активные услуги.

## Локальный запуск

```bash
python3.11 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
cp .env.example .env
python -m app.main
```

## График работы

По умолчанию после первого запуска заполняется таблица `work_schedule`:

- Пн-Пт: `00:00-23:59`
- Сб-Вс: `09:00-23:00`

Изменение графика в будущем делается через таблицу `work_schedule`.

## Структура проекта

- `app/bot/handlers` - роуты клиента/админа
- `app/bot/keyboards` - inline-клавиатуры
- `app/services` - бизнес-логика
- `app/db` - модели и сессия SQLAlchemy
- `app/scheduler` - задачи напоминаний
